<section class="mp-background">
  <div class="container d-flex flex-column min-vh-100 font-sans">
    <div class="row d-flex flex-grow-1">
      <div class="col-lg-12 z-1 pt-4">
        <img src="image.png" alt="MasrPay Logo" class="mb-4 z-1" style="width: 10rem;" />
      </div>
      <div class="d-md-flex col-lg-6 col-md-12 justify-content-start align-items-start px-4">
        <div class="col-lg-10 col-md-12 m-auto">
          <div class="position-relative z-0 m-auto text-center">
            <h2 class="fw-bold text-dark mb-3">
              Security Setup<br>
              <span style="font-size: 20px; font-weight: 400;">Change your password for security.</span>
            </h2>
            <p class="text-secondary col-lg-12 col-sm-8 text-sm-center mx-auto">
              For your security, please change your password. Your new password must meet the requirements below.
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-12 d-flex align-items-center justify-content-center px-3 pb-5 z-1">
        <div class="w-100" style="max-width: 28rem;">
          <div class="border border-secondary rounded p-4">
            <h2 class="h4 fw-semibold text-center text-dark mb-4">Change Password</h2>
            <div *ngIf="successMsg" class="alert alert-success mb-3">{{ successMsg }}</div>
            <div *ngIf="errorMsg" class="alert alert-danger mb-3">{{ errorMsg }}</div>
            <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
              <div class="mb-3">
                <label class="form-label text-secondary">Current Password</label>
                <div class="input-group">
                  <input style="font-size: small;"
                    [type]="showCurrentPassword ? 'text' : 'password'"
                    formControlName="current_password"
                    placeholder="Enter your current password"
                    class="form-control" />
                  <button type="button" class="btn btn-outline-secondary" (click)="toggleCurrentPasswordVisibility()">
                    <i class="bi" [class.bi-eye]="!showCurrentPassword" [class.bi-eye-slash]="showCurrentPassword"></i>
                  </button>
                </div>
                <div *ngIf="passwordForm.get('current_password')?.touched && passwordForm.get('current_password')?.invalid" class="form-text text-danger">
                  <span *ngIf="passwordForm.get('current_password')?.errors?.['required']">Current password is required.</span>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label text-secondary">New Password</label>
                <div class="input-group">
                  <input style="font-size: small;"
                    [type]="showNewPassword ? 'text' : 'password'"
                    formControlName="password"
                    placeholder="Enter new password"
                    class="form-control" />
                  <button type="button" class="btn btn-outline-secondary" (click)="toggleNewPasswordVisibility()">
                    <i class="bi" [class.bi-eye]="!showNewPassword" [class.bi-eye-slash]="showNewPassword"></i>
                  </button>
                </div>
                <!-- Password Requirements List -->
                <div class="password-requirements mt-2">
                  <small class="text-muted">Password Requirements:</small>
                  <ul class="list-unstyled mt-1 mb-0">
                                         <li class="requirement-item">
                       <span class="requirement-icon" [class.valid]="passwordRequirements.minLength" [class.invalid]="!passwordRequirements.minLength">
                         <i class="bi" [class.bi-check-circle-fill]="passwordRequirements.minLength" [class.bi-x-circle-fill]="!passwordRequirements.minLength"></i>
                       </span>
                       <span class="requirement-text">At least 15 characters</span>
                     </li>
                    <li class="requirement-item">
                      <span class="requirement-icon" [class.valid]="passwordRequirements.mixedCase" [class.invalid]="!passwordRequirements.mixedCase">
                        <i class="bi" [class.bi-check-circle-fill]="passwordRequirements.mixedCase" [class.bi-x-circle-fill]="!passwordRequirements.mixedCase"></i>
                      </span>
                      <span class="requirement-text">Uppercase and lowercase letters</span>
                    </li>
                    <li class="requirement-item">
                      <span class="requirement-icon" [class.valid]="passwordRequirements.letters" [class.invalid]="!passwordRequirements.letters">
                        <i class="bi" [class.bi-check-circle-fill]="passwordRequirements.letters" [class.bi-x-circle-fill]="!passwordRequirements.letters"></i>
                      </span>
                      <span class="requirement-text">At least one letter</span>
                    </li>
                    <li class="requirement-item">
                      <span class="requirement-icon" [class.valid]="passwordRequirements.numbers" [class.invalid]="!passwordRequirements.numbers">
                        <i class="bi" [class.bi-check-circle-fill]="passwordRequirements.numbers" [class.bi-x-circle-fill]="!passwordRequirements.numbers"></i>
                      </span>
                      <span class="requirement-text">At least one number</span>
                    </li>
                    <li class="requirement-item">
                      <span class="requirement-icon" [class.valid]="passwordRequirements.symbols" [class.invalid]="!passwordRequirements.symbols">
                        <i class="bi" [class.bi-check-circle-fill]="passwordRequirements.symbols" [class.bi-x-circle-fill]="!passwordRequirements.symbols"></i>
                      </span>
                      <span class="requirement-text">At least one symbol</span>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label text-secondary">Confirm New Password</label>
                <div class="input-group">
                  <input style="font-size: small;"
                    [type]="showConfirmPassword ? 'text' : 'password'"
                    formControlName="password_confirmation"
                    placeholder="Re-enter new password"
                    class="form-control" />
                  <button type="button" class="btn btn-outline-secondary" (click)="toggleConfirmPasswordVisibility()">
                    <i class="bi" [class.bi-eye]="!showConfirmPassword" [class.bi-eye-slash]="showConfirmPassword"></i>
                  </button>
                </div>
                <div *ngIf="passwordForm.hasError('passwordsMismatch') && passwordForm.get('password_confirmation')?.touched" class="form-text text-danger">
                  Passwords do not match.
                </div>
              </div>
              <button
                type="submit"
                [disabled]="passwordForm.invalid || isLoading"
                class="btn w-100 mt-2 text-white fw-semibold shadow-sm"
                style="background-color: rgb(204, 23, 30);">
                <span *ngIf="isLoading">Changing Password...</span>
                <span *ngIf="!isLoading">Change Password</span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section> 